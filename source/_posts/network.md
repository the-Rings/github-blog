---
title: network
date: 2022-07-31 21:14:47
categories:
- Network
---
##### 网络通信有两种体系结构：客户-服务器体系结构、P2P体系结构

##### 无论那种体系结构，网络通信，实际上是进程间的通信，通过计算机网络交换message(报文)而相互通信

##### 进程通过socket的接口向网络发送message(报文)和从网络中接收message(报文)
1. socket是程序进程与传输层之间的接口
2. 开发者可以控制socket在应用端的everything，但是对socket的传输层几乎没有控制权

##### packet会在计算机网络传输的过程中丢失
1. packet造成路由器中的缓存溢出，或者packet某些比特损坏后会被丢弃，或者底层信道出现了丢包
2. 我们呼唤一种可靠的数据传输(reliable data transfer)协议
3. 我们呼唤在发送时，传输层协议能够加密由发送进程传输的所有数据，在接受主机中，传输层协议将数据解密交付给接收进程

##### 传输层协议是在端系统(操作系统)中实现的
1. 在网络模型的协议栈中，传输层位于网络层之上。网络层提供了*主机之间*的逻辑通信，而传输层为运行在不同主机上的*进程之间*提供了逻辑通信

##### 传输层将从发送进程接受到的message(报文)转换为传输层的segment
1. 实现方法是，将应用层的报文划分为小块，并未每块加上一个传输层首部生成传输层segment，然后在发送端系统中，传输层将这些segment传递给网络层，网络层(即路由器)再将其封装成网络层packet(分组)，即数据报，并向目的地发送。

##### TCP/IP网络(因特网)为提供了两种传输层协议TCP和UDP

##### TCP服务模型包括两个部分：面向连接的服务 和 可靠的数据传输服务
1. UDP是一种不可靠、无连接的服务

##### UDP和TCP最基本的责任是，将两个系统间的IP的交付服务扩展为运行在端系统上的进程之间的服务
1. 进程到进程的数据交付（交付到IP层，也叫网络层）和差错检查是两种最低限度的传输层服务，也是UDP仅有的两个服务
2. 在IP交付服务的实现上，UDP无非就是对网络层协议增加了多路复用和多路分解的功能而已。将传输层segment中的数据交付到对应socket的工作称为多路分解(demultiplex)，在源主机从不同的socket中收集数据块，并为每个数据块装上首部信息，生成segment，然后将segment传递到网络层，这个过程称为多路复用(multiplex)，多路复用和分解的具体实现可以看：{% post_link network-io-multiplex '图解多路复用' %}
2. 除了UDP提供的两个服务之外，TCP为应用提供了几种附加服务，包括可靠的数据传输、拥堵控制(congestion control)

##### TCP的服务包括两个方面的内容：面向连接的服务 和 可靠的数据传输服务
1. 在message(报文)开始流动之前，TCP让客户端和服务器交换传输层的控制信息，这个被俗称为“握手”过程
2. 握手结束后，一个TCP连接就在两个进程的socket之间建立了
3. 这个连接数全双工的，即连接双方的进程可以在此连接上同时进行message(报文)的收发
1. 发送进程能够依靠TCP，无差错、按适当顺序交付所有发送的数据
2. 接受进程能够依靠TCP接受所有字节，没有字节丢失和冗余

##### 用SSL加强后的TCP，不仅能够做传统的TCP所作的一切，而且提供了安全服务，包括加密，数据完整性和端点鉴别
1. TCP和UDP没有任何加密机制，就是说发送进程传进socket的数据与经网络传送到目的地的进程数据相同
2. 这种强化是在应用层上实现的


##### 构造可靠的数据传输(reliable data transfer)服务经历了三种模型：rdt1.0/rdt2.0/rdt3.0
我们的假设前提，从理想逐渐到现实。
首先，假定底层信道是完全可靠的，比特不会丢失，并且是有序的。那就是rdt1.0，这个模型十分简单，就是发送进程发送数据，接收进程接收数据
然后，把底层信道变为比特可能受损的模型。在packet传输的过程中，网络物理部件会出现比特差错，导致某个packet受损，但是按其发送顺序被接收。此时我们要引入差错检查、接收方反馈和重传机制。这对应rdt2.0
1. 差错检查，在首部信息中引入检验和的字段。
2. 接受方反馈，“肯定确认packet”ACK和“否定确认packet”NCK
3. 重传，接收方收到有差错的packet，发送NCK，然后发送方重传该packet
再者，在rdt2.0的基础上，还有一种情况，那就是ACK和NCK对应的packet受损。直观的办法是，当发送方收到一个“含糊不清（受损）”的NCK或者ACK时，只需要重传即可，也就是增加一个冗余packet，但是困难是，接收方不知道，上次发送的ACK或NCK是否被发送方收到，也就不知道当前的packet是新的还是重传的。解决这个难题的一个简单方法（几乎所有的传输层协议中都采用了这种方法），就是在packet中加入一个序号（sequence number）字段，于是接收方只需要检查序号，就知道发送方是否在重传前一个分组。
再者，底层信道出了比特受损意外，还会出现丢包。



